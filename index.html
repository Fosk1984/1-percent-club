<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>1% Club ‚Äî Multiplayer (Firebase)</title>
  <meta name="description" content="Host-controlled 1% Club style quiz with up to 80 players. Built for GitHub Pages + Firebase Realtime Database.">
  <link rel="icon" href="data:,"><!-- silence favicon 404 on GitHub Pages -->
  <style>
    :root{
      --bg:#0b0f1a; --card:#12172a; --ink:#eaf0ff; --muted:#9aa4bf; --edge:#22315c;
      --acc:#6ac2ff; --acc2:#ffd36a; --ok:#33d17a; --bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink); background:radial-gradient(1200px 800px at 15% -10%, #182449 0%, #0f1730 40%, var(--bg) 100%);
    }
    .shell{max-width:1100px; margin:0 auto; padding:24px}
    h1{margin:0 0 12px; font-size:clamp(22px,3.2vw,36px)}
    h2{margin:18px 0 8px; font-size:clamp(18px,2.2vw,24px)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.08)); border:1px solid var(--edge);
      box-shadow:0 10px 30px rgba(0,0,0,.35); border-radius:16px; padding:16px; margin:12px 0}
    .grid{display:grid; gap:12px}
    .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    label{font-size:14px; color:var(--muted)}
    input, textarea, select{width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--edge);
      background:#0f1530; color:var(--ink)}
    textarea{min-height:100px; resize:vertical}
    button{cursor:pointer; border:1px solid var(--edge); background:linear-gradient(180deg,#1a254d,#121a38);
      color:var(--ink); padding:10px 14px; border-radius:12px; font-weight:600; box-shadow:0 6px 16px rgba(0,0,0,.35)}
    button[disabled]{opacity:.5; cursor:not-allowed}
    .btn-acc{background:linear-gradient(180deg,#3aa7ff,#2263a2)}
    .btn-acc2{background:linear-gradient(180deg,#ffd36a,#c49e2e); color:#1a1400}
    .btn-ok{background:linear-gradient(180deg,#33d17a,#1a7a49)}
    .btn-bad{background:linear-gradient(180deg,#ff6b6b,#b13a3a)}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .hint{color:var(--muted); font-size:13px}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      background:#0d1430; border:1px solid var(--edge); font-size:13px}
    .timer{font-variant-numeric:tabular-nums; font-size:22px}
    .answers{display:grid; gap:10px; grid-template-columns:1fr}
    .answerBtn{padding:16px; text-align:left; border-radius:14px; border:1px solid var(--edge); background:#101a3a;
      font-size:16px}
    .answerBtn.selected{outline:2px solid var(--acc)}
    .answerBtn.correct{outline:2px solid var(--ok)}
    .answerBtn.wrong{outline:2px solid var(--bad)}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .list{max-height:260px; overflow:auto; padding-right:6px}
    .tag{padding:.2rem .45rem; border-radius:8px; border:1px solid var(--edge); background:#0c1230; font-size:12px}
    .center{display:flex; align-items:center; justify-content:center}
    .big{font-size:clamp(28px,4vw,44px); font-weight:700}
    .hide{display:none !important}
  </style>
</head>
<body>
  <div class="shell">
    <h1>üß† The 1% Club ‚Äî Multiplayer</h1>
    <div id="landing" class="card">
      <div class="row">
        <label class="pill"><input type="checkbox" id="isHostToggle"> &nbsp; I'm the host</label>
        <span class="hint">GitHub Pages + Firebase (Anonymous sign-in). Room code sharing built-in.</span>
      </div>
      <div id="hostLanding" class="grid g2" style="margin-top:8px;">
        <div class="card">
          <h2>Host: create a room</h2>
          <div class="grid g2">
            <div>
              <label>Room code (optional)</label>
              <input id="hostRoomCode" maxlength="6" placeholder="e.g. 7H2K9Q" />
            </div>
            <div>
              <label>Player limit</label>
              <input id="playerLimit" type="number" min="2" max="80" value="80" />
            </div>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="createRoomBtn" class="btn-acc">Create room</button>
            <span class="hint">You‚Äôll join as host (not a contestant).</span>
          </div>
        </div>
        <div class="card">
          <h2>Players: join a room</h2>
          <div class="grid g2">
            <div>
              <label>Room code</label>
              <input id="joinCode" maxlength="6" placeholder="Enter code" />
            </div>
            <div>
              <label>Your display name</label>
              <input id="displayName" maxlength="24" placeholder="e.g. Alex" />
            </div>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="joinBtn" class="btn-ok">Join game</button>
            <span class="hint">Up to 80 players. Eliminated on wrong answer.</span>
          </div>
        </div>
      </div>
    </div>

    <div id="hostUI" class="card hide">
      <div class="row">
        <div class="pill">Room: <span id="roomCodeHost" class="mono"></span></div>
        <div class="pill">Players alive: <span id="aliveCount">0</span></div>
        <div class="pill">Question #<span id="qNumber">0</span></div>
        <button id="copyInvite" class="">Copy invite</button>
      </div>

      <div class="grid g2" style="margin-top:10px">
        <div class="card">
          <h2>Question builder</h2>
          <label>Question prompt</label>
          <textarea id="qPrompt" placeholder="e.g. What is 15% of 220?"></textarea>
          <div class="grid g2">
            <div><label>A</label><input id="opt0" placeholder="e.g. 33"/></div>
            <div><label>B</label><input id="opt1" placeholder="e.g. 30"/></div>
            <div><label>C</label><input id="opt2" placeholder="e.g. 22"/></div>
            <div><label>D</label><input id="opt3" placeholder="e.g. 28"/></div>
          </div>
          <div class="row" style="margin-top:10px">
            <label>Correct answer</label>
            <select id="correctIndex">
              <option value="0">A</option>
              <option value="1">B</option>
              <option value="2">C</option>
              <option value="3">D</option>
            </select>
            <label>Answer window</label>
            <select id="answerWindow">
              <option value="30">30 seconds</option>
              <option value="20">20 seconds</option>
              <option value="15">15 seconds</option>
              <option value="10">10 seconds</option>
            </select>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="stageHiddenBtn">1) Arm question (hidden)</button>
            <button id="revealBtn" class="btn-acc">2) Reveal to players & start timer</button>
            <button id="lockBtn" class="btn-bad">3) Lock answers now</button>
            <button id="scoreBtn" class="btn-ok">4) Reveal correct & eliminate</button>
            <button id="nextBtn" class="btn-acc2">Next question</button>
          </div>
          <div class="hint">Flow: Arm ‚Üí Reveal (timer starts) ‚Üí Lock (optional) ‚Üí Reveal correct & eliminate ‚Üí Next.</div>
        </div>
        <div class="card">
          <h2>Players</h2>
          <div id="playersList" class="list"></div>
        </div>
      </div>

      <div class="card">
        <h2>Live question</h2>
        <div class="row">
          <div class="pill">Phase: <span id="phaseTxt">‚Äî</span></div>
          <div class="pill">Deadline: <span id="deadlineTxt" class="timer">‚Äî</span></div>
        </div>
        <div id="livePrompt" class="big" style="margin-top:8px">‚Äî</div>
        <div id="liveChoices" class="grid g2" style="margin-top:8px"></div>
      </div>
    </div>

    <div id="playerUI" class="card hide">
      <div class="row">
        <div class="pill">Room: <span id="roomCodePlayer" class="mono"></span></div>
        <div class="pill">Name: <span id="meName" class="mono"></span></div>
        <div class="pill">Status: <span id="statusTxt">Waiting‚Ä¶</span></div>
        <div class="pill">Time left: <span id="timeLeft" class="timer">‚Äî</span></div>
      </div>
      <div id="msg" class="muted" style="margin-top:6px">Waiting for host‚Ä¶</div>
      <div id="qArea" class="hide">
        <div id="pPrompt" class="big" style="margin:10px 0">‚Äî</div>
        <div class="answers" id="answerBtns"></div>
      </div>
      <div id="eliminated" class="hide center" style="height:160px"><div class="big">‚ùå You‚Äôve been eliminated</div></div>
    </div>

    <div class="card" id="howto">
      <h2>Setup (one-time)</h2>
      <ol>
        <li>Create a Firebase project ‚Üí enable <b>Anonymous Auth</b> and create a <b>Realtime Database</b> (locked mode).</li>
        <li>Copy your Firebase <b>web config</b> and paste into <span class="mono">FIREBASE_CONFIG</span> below in the code.</li>
        <li>Paste these <b>Rules</b> into Realtime Database ‚Üí Rules tab (you can tighten later):<br>
<pre class="small" style="white-space:pre-wrap; background:#0c1230; padding:10px; border-radius:12px; border:1px solid var(--edge)">{
  "rules": {
    ".read": false,
    ".write": false,
    "rooms": {
      "$code": {
        ".read": "auth != null && (root.child('rooms/'+$code+'/players/'+auth.uid+'/present').val() == true || root.child('rooms/'+$code+'/meta/hostUid').val() == auth.uid)",
        "meta": {
          ".write": "auth != null && (!data.exists() || root.child('rooms/'+$code+'/meta/hostUid').val() == auth.uid)"
        },
        "current": {
          ".read": "auth != null",
          ".write": "auth != null && root.child('rooms/'+$code+'/meta/hostUid').val() == auth.uid"
        },
        "players": {
          "$uid": {
            ".read": "auth != null",
            ".write": "auth != null && $uid == auth.uid",
            "eliminated": { ".write": "auth != null && root.child('rooms/'+$code+'/meta/hostUid').val() == auth.uid" }
          }
        },
        "answers": {
          "$qid": {
            "$uid": {
              ".write": "auth != null && auth.uid == $uid && now <= root.child('rooms/'+$code+'/current/deadline').val() && $qid == root.child('rooms/'+$code+'/current/qid').val() && !data.exists()",
              ".read": "auth != null && root.child('rooms/'+$code+'/meta/hostUid').val() == auth.uid"
            }
          }
        }
      }
    }
  }
}
</pre>
        </li>
        <li>Commit this single <b>index.html</b> file to a GitHub repo ‚Üí enable GitHub Pages (main branch /root).</li>
      </ol>
    </div>
  </div>

  <!-- üîß Replace FIREBASE_CONFIG below with your actual Firebase web config -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signInAnonymously, updateProfile } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';
    import { getDatabase, ref, child, get, set, update, onValue, onChildAdded, onChildRemoved, runTransaction, onDisconnect } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js';

    // üëâ Paste your Firebase project config here
    const FIREBASE_CONFIG = {
     apiKey: "AIzaSyAAlHBdemzktDB25HozuliuL6BWcYZ7hUg",
  authDomain: "percent-club-76c05.firebaseapp.com",
  projectId: "percent-club-76c05",
  storageBucket: "percent-club-76c05.appspot.com",
  messagingSenderId: "87140817040",
  appId: "1:87140817040:web:aee1db0e278e641f97a015",
  measurementId: "G-8V0MWEYWLZ",
  databaseURL: "https://percent-club-76c05-default-rtdb.europe-west1.firebasedatabase.app/"
    };

    // --- App state ---
    const app = initializeApp(FIREBASE_CONFIG);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const els = (q)=>document.querySelector(q);
    const $$ = (q)=>Array.from(document.querySelectorAll(q));
    const state = { uid:null, room:null, host:false, me:null, current:null, timerInt:null };

    // UI elements
    const landing = els('#landing');
    const hostLanding = els('#hostLanding');
    const isHostToggle = els('#isHostToggle');
    const hostRoomCode = els('#hostRoomCode');
    const playerLimitEl = els('#playerLimit');
    const createRoomBtn = els('#createRoomBtn');
    const joinCode = els('#joinCode');
    const displayName = els('#displayName');
    const joinBtn = els('#joinBtn');

    const hostUI = els('#hostUI');
    const roomCodeHost = els('#roomCodeHost');
    const aliveCount = els('#aliveCount');
    const qNumber = els('#qNumber');
    const copyInvite = els('#copyInvite');
    const playersList = els('#playersList');
    const phaseTxt = els('#phaseTxt');
    const deadlineTxt = els('#deadlineTxt');
    const livePrompt = els('#livePrompt');
    const liveChoices = els('#liveChoices');

    const qPrompt = els('#qPrompt');
    const opt0 = els('#opt0');
    const opt1 = els('#opt1');
    const opt2 = els('#opt2');
    const opt3 = els('#opt3');
    const correctIndex = els('#correctIndex');
    const answerWindow = els('#answerWindow');
    const stageHiddenBtn = els('#stageHiddenBtn');
    const revealBtn = els('#revealBtn');
    const lockBtn = els('#lockBtn');
    const scoreBtn = els('#scoreBtn');
    const nextBtn = els('#nextBtn');

    const playerUI = els('#playerUI');
    const roomCodePlayer = els('#roomCodePlayer');
    const meName = els('#meName');
    const statusTxt = els('#statusTxt');
    const timeLeft = els('#timeLeft');
    const pPrompt = els('#pPrompt');
    const answerBtns = els('#answerBtns');
    const qArea = els('#qArea');
    const msg = els('#msg');
    const eliminated = els('#eliminated');

    // Helpers
    const codeChars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    const genCode = (len=6)=>Array.from({length:len},()=>codeChars[Math.floor(Math.random()*codeChars.length)]).join('');
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

    // Auth flow
    onAuthStateChanged(auth, async (user)=>{
      if(user){ state.uid = user.uid; return; }
      await signInAnonymously(auth);
    });

    // Landing mode toggle
    isHostToggle.addEventListener('change', ()=>{
      state.host = isHostToggle.checked;
      hostLanding.classList.toggle('hide', !state.host);
    });

    // Host: create room
    createRoomBtn.addEventListener('click', async ()=>{
      const code = (hostRoomCode.value || genCode()).toUpperCase();
      const limit = Math.min(80, Math.max(2, parseInt(playerLimitEl.value||"80",10)));
      const roomRef = ref(db, `rooms/${code}`);
      await set(child(roomRef,'meta'), {
        hostUid: state.uid,
        allowJoin: true,
        playerLimit: limit,
        qIndex: 0,
        createdAt: Date.now()
      });
      // init current minimal (hidden)
      await set(child(roomRef,'current'), { phase:'hidden', qid:0 });
      state.room = code; state.host = true;
      enterHost();
    });

    // Player: join
    joinBtn.addEventListener('click', async ()=>{
      const code = (joinCode.value||'').toUpperCase().trim();
      const name = (displayName.value||'Player').trim();
      if(!code) return alert('Enter room code');
      const roomRef = ref(db, `rooms/${code}`);
      const snap = await get(child(roomRef,'meta'));
      if(!snap.exists()) return alert('Room not found');
      const meta = snap.val();
      if(!meta.allowJoin) return alert('Host has closed joining');

      // Soft capacity check
      const playersSnap = await get(child(roomRef,'players'));
      const count = playersSnap.exists()? Object.values(playersSnap.val()).filter(p=>p.present && !p.eliminated).length : 0;
      if(count >= (meta.playerLimit||80)) return alert('Room is full');

      // Upsert player profile
      await update(child(roomRef,`players/${state.uid}`), {
        name, present:true, eliminated:false, joinedAt: Date.now()
      });
      // Clean up on disconnect
      const meRef = child(roomRef,`players/${state.uid}/present`);
      onDisconnect(meRef).set(false);

      state.room = code; state.host = false; state.me = {name};
      enterPlayer();
    });

    // ---- Host UI handlers ----
    async function enterHost(){
      landing.classList.add('hide');
      hostUI.classList.remove('hide');
      roomCodeHost.textContent = state.room;
      wireRoomListeners();
    }

    // Arm question (hidden)
    stageHiddenBtn.addEventListener('click', async ()=>{
      const code = state.room; if(!code) return;
      const metaRef = ref(db, `rooms/${code}/meta`);
      const metaSnap = await get(metaRef); const meta = metaSnap.val();
      const qid = (meta.qIndex||0)+1;
      await update(metaRef, { qIndex: qid });
      await set(ref(db,`rooms/${code}/current`), { phase:'hidden', qid, prompt:null, choices:null });
      qNumber.textContent = qid;
      phaseTxt.textContent = 'hidden';
    });

    // Reveal question & start timer
    revealBtn.addEventListener('click', async ()=>{
      if(!qPrompt.value.trim()) return alert('Enter a question');
      const choices = [opt0.value, opt1.value, opt2.value, opt3.value];
      if(choices.some(c=>!c || !c.trim())) return alert('Enter all 4 choices');
      const secs = parseInt(answerWindow.value,10);
      const code = state.room; const currentRef = ref(db,`rooms/${code}/current`);
      const curSnap = await get(currentRef); const cur = curSnap.val();
      const deadline = Date.now() + secs*1000;
      await update(currentRef, {
        phase:'revealed', prompt:qPrompt.value.trim(), choices, deadline
      });
    });

    // Lock answers now (forces deadline to now)
    lockBtn.addEventListener('click', async ()=>{
      const code = state.room; const currentRef = ref(db,`rooms/${code}/current`);
      await update(currentRef, { phase:'locked', deadline: Date.now() });
    });

    // Score: reveal correct & eliminate wrong
    scoreBtn.addEventListener('click', async ()=>{
      const code = state.room; const currentRef = ref(db,`rooms/${code}/current`);
      const cur = (await get(currentRef)).val();
      if(cur.phase === 'hidden') return alert('Reveal first');
      const cIdx = parseInt(correctIndex.value,10);
      await update(currentRef, { phase:'result', correctIndex: cIdx });

      // Fetch answers + players
      const [ansSnap, playersSnap] = await Promise.all([
        get(ref(db,`rooms/${code}/answers/${cur.qid}`)),
        get(ref(db,`rooms/${code}/players`))
      ]);
      const answers = ansSnap.exists()? ansSnap.val(): {};
      const players = playersSnap.exists()? playersSnap.val(): {};

      const updates = {};
      let alive = 0, eliminatedCount = 0;
      Object.entries(players).forEach(([uid, p])=>{ if(p.present && !p.eliminated) alive++; });
      // eliminate wrong + no-answers
      Object.entries(players).forEach(([uid,p])=>{
        if(!(p.present && !p.eliminated)) return;
        const a = answers[uid];
        const wrongOrMissing = !a || a.index !== cIdx;
        if(wrongOrMissing){
          updates[`rooms/${code}/players/${uid}/eliminated`] = true; eliminatedCount++;
        }
      });
      await update(ref(db), updates);
    });

    // Next question (clear current)
    nextBtn.addEventListener('click', async ()=>{
      const code = state.room; const meta = (await get(ref(db,`rooms/${code}/meta`))).val();
      const qid = (meta.qIndex||0) + 1;
      await update(ref(db,`rooms/${code}/meta`), { qIndex: qid });
      await set(ref(db,`rooms/${code}/current`), { phase:'hidden', qid, prompt:null, choices:null });
      qPrompt.value = opt0.value = opt1.value = opt2.value = opt3.value = '';
      correctIndex.value = '0';
    });

    copyInvite.addEventListener('click', async ()=>{
      const url = `${location.origin}${location.pathname}?room=${state.room}`;
      await navigator.clipboard.writeText(`Join my 1% Club game: ${url} (code ${state.room})`);
      copyInvite.textContent = 'Copied!'; setTimeout(()=>copyInvite.textContent='Copy invite',1500);
    });

    // ---- Player UI ----
    async function enterPlayer(){
      landing.classList.add('hide');
      playerUI.classList.remove('hide');
      roomCodePlayer.textContent = state.room;
      meName.textContent = state.me?.name || '';
      wireRoomListeners();
    }

    // ---- Shared room listeners ----
    function wireRoomListeners(){
      const code = state.room; if(!code) return;
      // Live meta
      onValue(ref(db,`rooms/${code}/meta`), (snap)=>{
        const meta = snap.val()||{}; qNumber.textContent = meta.qIndex||0;
      });
      // Live current
      onValue(ref(db,`rooms/${code}/current`), (snap)=>{
        state.current = snap.val()||{};
        const cur = state.current;
        // Host view
        phaseTxt.textContent = cur.phase || '‚Äî';
        deadlineTxt.textContent = cur.deadline? new Date(cur.deadline).toLocaleTimeString(): '‚Äî';
        livePrompt.textContent = cur.prompt || '‚Äî';
        liveChoices.innerHTML = '';
        if(cur.choices){ cur.choices.forEach((c,i)=>{
          const div = document.createElement('div'); div.className='tag'; div.textContent = ['A','B','C','D'][i]+': '+c; liveChoices.appendChild(div);
        }); }
        // Player view
        if(!state.host){
          statusTxt.textContent = cur.phase;
          if(cur.phase === 'revealed'){
            msg.classList.add('hide'); qArea.classList.remove('hide'); eliminated.classList.add('hide');
            pPrompt.textContent = cur.prompt || '‚Äî';
            renderAnswerButtons(cur);
            startTimer(cur.deadline);
          } else if(cur.phase === 'locked'){
            stopTimer(); timeLeft.textContent = '0';
          } else if(cur.phase === 'result'){
            stopTimer();
            revealCorrect(cur);
          } else { // hidden or others
            msg.classList.remove('hide'); qArea.classList.add('hide');
          }
        }
      });
      // Players list for host + count for both
      onValue(ref(db,`rooms/${code}/players`), (snap)=>{
        const players = snap.val()||{};
        const alive = Object.values(players).filter(p=>p.present && !p.eliminated).length;
        aliveCount.textContent = alive;
        if(state.host){
          playersList.innerHTML = '';
          Object.entries(players).forEach(([uid,p])=>{
            const row = document.createElement('div'); row.className='row';
            const name = document.createElement('div'); name.textContent = p.name||'Player';
            const tags = document.createElement('div'); tags.className='row';
            tags.innerHTML = `<span class="tag">${p.present? 'present':'offline'}</span> <span class="tag">${p.eliminated? '‚ùå out':'‚úÖ in'}</span>`;
            row.appendChild(name); row.appendChild(tags); playersList.appendChild(row);
          });
        } else {
          const me = players[state.uid]||{};
          if(me.eliminated){ qArea.classList.add('hide'); eliminated.classList.remove('hide'); }
        }
      });
    }

    function renderAnswerButtons(cur){
      answerBtns.innerHTML = '';
      ['A','B','C','D'].forEach((letter,i)=>{
        const btn = document.createElement('button'); btn.className='answerBtn';
        btn.textContent = `${letter}. ${cur.choices?.[i]||''}`;
        btn.addEventListener('click', ()=> submitAnswer(i));
        answerBtns.appendChild(btn);
      });
    }

    async function submitAnswer(index){
      const code = state.room; const cur = state.current; if(!cur || cur.phase!=='revealed') return;
      const ansRef = ref(db,`rooms/${code}/answers/${cur.qid}/${state.uid}`);
      try{
        await set(ansRef, { index, at: Date.now() });
        // highlight selection locally
        $$('.answerBtn').forEach((b,bi)=> b.classList.toggle('selected', bi===index));
      }catch(err){ alert('Answer not accepted (maybe time is up).'); console.error(err); }
    }

    function revealCorrect(cur){
      if(cur.correctIndex == null) return; // host may set slightly later
      $$('.answerBtn').forEach((b,bi)=>{
        b.classList.toggle('correct', bi===cur.correctIndex);
        b.classList.toggle('wrong', bi!==cur.correctIndex);
        b.disabled = true;
      });
    }

    function startTimer(deadline){
      stopTimer();
      const tick = ()=>{
        const ms = Math.max(0, deadline - Date.now());
        const s = Math.ceil(ms/1000); timeLeft.textContent = String(s);
        if(ms<=0) stopTimer();
      };
      tick(); state.timerInt = setInterval(tick, 200);
    }
    function stopTimer(){ if(state.timerInt){ clearInterval(state.timerInt); state.timerInt=null; } }
  </script>
</body>
</html>
